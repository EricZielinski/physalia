<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Physalia - Monsoon Tutorial</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    >
    <link rel="stylesheet" href="css/app.css" type="text/css" media="screen">
  </head>
  <body>

<article id="monsoon_tutorial" class="container">
<header class="page-header">
<h1 id="measure_energy_consumption_with_monsoon">How to measure energy consumption with Monsoon<br/>
<div class="pull-right">
<a href="https://twitter.com/share" class="twitter-share-button" data-text="Great article on how to measure the energy consumption of your mobile app." data-url="https://tqrg.github.io/physalia/monsoon_tutorial" data-hashtags="physalia" data-related="luismcruz,rmaranhao" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
<small>An easy tutorial with <a href='https://tqrg.github.io/physalia' target='_blank'>Physalia</a></small>
</h1>
</header>
<p class="lead">
    In this tutorial we are going through how to measure the energy consumption of your mobile application using the <strong>Monsoon Power Monitor</strong> with the smartphone <strong>Nexus 5X</strong>.
</p>
<p>
Writing energy efficient code is very important when it comes to mobile applications development. However, having a setup for energy measurements can be a complex task. Besides, most developers (like us) don't have the knowledge required to do it without some help.
</p>
<p>
In this article we show how we have set up out experiments. We go over how to open a Nexus 5X and connect it to a power monitor. This can help developers easily start measuring their Android apps.
</p>

<p class="text-danger">
    <strong>Warning: </strong>The procedure described in this article will void the phone's battery. It will no longer be appropriate for use with the device. Since the procedure requires opening the Nexus 5X, the device's warranty will be voided. This article intends to make it simpler, but the authors cannot take responsibility for any possible harm it may cause. Do it at your own risk.
</p>
<h3>Material needed</h3>
<ul>
  <li>Nexus 5X</li>
  <li>Monsoon Power Monitor</li>
  <li>Computer</li>
  <li>Electronic Wire</li>
  <li>Pliers</li>
  <li>Soldering iron</li>
</ul>

<h3>Opening Nexus 5X</h3>
<p>
In order to measure energy consumption we have to replace the battery with our new power supply &mdash; Monsoon. This means that we need to remove the battery!
</p>
<p>This task used to be simpler, however most phones nowadays do not come with a replaceable battery.
The phone has to be opened.
There are many tutorials online that make it simple by going through all the steps. It is the case of <a href="https://www.ifixit.com/Guide/Nexus+5X+Battery+Replacement/60275" target="_blank">this one from iFixit</a>.

</p>

<h3>Bypassing the battery</h3>

<p>
Now that we removed the battery we can see that it no longer comes with two traditional positive and negative connectors.
It comes with a very small plug, which makes it hard to make a proper and isolated connection.
In addition, the battery also sends a digital code that is required to make the phone work. Unfortunately, this code cannot be replicated by the power monitor.
</p>
<figure>
    <img class="img-rounded img-responsive center-block" src="media/nexus_battery_notated.JPG" width="410" height="410" alt="Nexus Battery">
</figure>
<p>
Basically this means that our battery comes with two main parts: <strong>battery cells</strong> that provide the power and an <strong>integrated electronic component</strong> that, among other things, generates the required signal.
</p>
<figure>
<img class="img-rounded img-responsive center-block" src="media/nexus_eletronic_component.png" width="410" height="410" alt="Nexus Eletronic Component">
</figure>
<p>
The cleanest solution is to disassemble the battery, and separate the cells from the electronic component.
<span class='text-danger'>Be aware that this part requires extra care. Battery cells must be intact, and positive and negative connectors must always be isolated from each other. 
</span>
</p>
<p>
Start by removing the soft cover on the top of the battery as shown in the picture.
The component we need is the one with a rigid black cover.
Detach it from the cell and remove the cover with the help of a pliers.
Note that this point is irreversible.
</p>
<p>
The cell was connected to the electronic component simply by the negative and positive poles. As shown in the figure below, solder a black and a colored wire to these connectors in the electronic component. As a standard rule, connect the black to the negative pole, and the colored (usually red) to the positive.
Use electrical tape to insulate the solderings.
</p>
<p>Now we can assemble our component back to the phone.</p>
<figure>
    <img class="img-rounded img-responsive center-block"src="media/nexus_soldering.png" width="670" height="335" alt="Nexus Soldering">
</figure>
<p>
<span class="text-success">The phone is ready to be connected to Monsoon!</span>
</p>

<h3>Connecting Monsoon to the phone</h3>
<p>
Monsoon comes with two handy wires to connect the power supplier. Connect them to the wires in the phone. Positive pole with positive pole and negative pole with negative pole &mdash; i.e., black with black and colored with colored.
</p>

<figure>
    <img class="img-rounded img-responsive center-block" src="media/nexus_monsoon_back.png" width="410" alt="Nexus Monsoon Back">
</figure>

<h3>Controlling Monsoon from a computer</h3>
<p>
Open a terminal window and install <a href='https://tqrg.github.io/physalia' target='_blank'>Physalia</a>:
</p>
<pre>
$ pip install physalia
</pre>
<p>
Now open your favorite editor and create a simple Python script:
</p>
<pre>
# myscript.py
from physalia.power_meters import MonsoonPowerMeter
from time import sleep

power_meter = MonsoonPowerMeter(voltage=3.8, sample_hz=5000, serial=12886)
power_meter.start()
sleep(5)
duration, energy, _ = power_meter.stop()
print "{} Joules consumed in {} seconds.".format(energy, duration)

</pre>
<p>

It sets the power supply to 3.8V. Be sure to change the Monsoon's serial number.
</p>
<p>
Run the script with:
</p>
<pre>
$ python myscript.py
</pre>

After finding and connecting Monsoon, it prompts to turn on the mobile device.
Once Nexus 5X is up and running, connect it through USB to the Monsoon.
If everything goes as expected, the script will give you the energy spent in five seconds.
</p>
<h3>It's done!</h3>
<p>

<figure>
    <img class="img-rounded img-responsive center-block" src="media/nexus_front.png" width="500" alt="Nexus Front">
</figure>
    
Good job! Now feel free to play around and explore the rest of the library <a href='https://tqrg.github.io/physalia' target='_blank'>Physalia</a>. It comes with many other features that make energy measurements easy for Android apps. Note that, for safety reasons, it is recommended to reassemble the other parts of the phone.
</p>
<p>
If you need extra help or have feedback, get in touch!
</p>

<h4>Acknowlegments</h4>
<p>
Kudos to <a href="http://sips.inesc-id.pt/~rjfc/" target='_blank'>Prof. Ricardo Chaves</a> for the valuable help given to set up Monsoon. He has the credits for disassembling the battery, soldering, and specially for coming up with this solution to bypass the battery. We did not have the knowledge to do it by ourselves. We hope this article will help developers that cannot count on the help of a Prof. Ricardo.
</p>

<hr/>
<footer>
<p>&copy; 2017 <a href="http://luiscruz.github.io/" target="_blank">Luis Cruz</a> and <a href="http://ruimaranhao.com/"  target="_blank">Rui Abreu</a>.
</p>
</footer>
</article>


  </body>
</html>
